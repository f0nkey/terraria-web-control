<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Dino Doggos - Terraria Control Panel</title>
    <link rel="stylesheet" type="text/css" href="style.css"/>
    <link href="https://fonts.googleapis.com/css?family=Lato:400,700&display=swap" rel="stylesheet">
  </head>

  <body>
    <div class="main">
      <div class="logo"></div>
      <div class="title">Dino Doggos</div>
      <div class="subtitle">Terraria Control Panel</div>
      <div class="buttons">
        <button id="dawn"><span>Dawn</span></button>
        <button id="noon"><span>Noon</span></button>
        <button id="dusk"><span>Dusk</span></button>
        <button id="midnight"><span>Midnight</span></button>
        <button id="save-world"><span>Save</span></button>
        <button id="hard-reset"><span>Hard Reset</span></button>
      </div>
      <div><p id="command-status"></p></div>
    </div>
  </body>

    <script>
      function submitCommand(cmd) {
        let url = window.location.href + "cmd"
        fetch(url, {method: "POST", body:cmd})
            .then(response => response.json())
            .then((data) => {
                if(data.msg === "error") {
                    setCmdStatus("Encountered error: " + data.error)
                    return
                }
                setCmdStatus("Processed command successfully.")
            }).catch((e) => {
            setCmdStatus("Encountered error: " + e)
        });
    }

    function setCmdStatus(text) {
        let el = document.getElementById("command-status")
        el.innerText = text
        el.classList.remove("anim")
        void el.offsetWidth
        el.classList.add("anim")
    }

    document.getElementById("dusk").addEventListener("click", ()=> {
        submitCommand("dusk")
    })
    document.getElementById("dawn").addEventListener("click", ()=> {
        submitCommand("dawn")
    })
    document.getElementById("noon").addEventListener("click", ()=> {
        submitCommand("noon")
    })
    document.getElementById("midnight").addEventListener("click", ()=> {
        submitCommand("midnight")
    })
    document.getElementById("hard-reset").addEventListener("click", ()=> {
      if(confirm("This will reboot the server WITHOUT SAVING. Are you sure?"))
      {
        setCmdStatus("Issuing hard reset ...")
        submitCommand("hardReset")
      }
    })
    document.getElementById("save-world").addEventListener("click", ()=> {
      submitCommand("save")
    })
    </script>

</html>
